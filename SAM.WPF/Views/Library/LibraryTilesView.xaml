<UserControl x:Class="SAM.WPF.Views.Library.LibraryTilesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:vm="clr-namespace:SAM.WPF.ViewModels"
             xmlns:models="clr-namespace:SAM.WPF.Core;assembly=SAM.WPF.Core"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:controls="clr-namespace:SAM.WPF.Core.Controls;assembly=SAM.WPF.Core"
             xmlns:behaviors="clr-namespace:SAM.WPF.Core.Behaviors;assembly=SAM.WPF.Core"
             mc:Ignorable="d" 
             DataContext="{dxmvvm:ViewModelSource Type=vm:HomeViewModel}"
             d:DataContext="{d:DesignInstance Type=vm:HomeViewModel, IsDesignTimeCreatable=False}"
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>
        <Style x:Key="LibraryTileStyle" TargetType="mah:Tile">
            <Setter Property="Background" Value="{StaticResource MahApps.Brushes.Accent}" />
            <Setter Property="CountFontSize" Value="28" />
            <Setter Property="Foreground" Value="{StaticResource MahApps.Brushes.IdealForeground}" />
            <Setter Property="mah:ControlsHelper.MouseOverBorderBrush" Value="{StaticResource MahApps.Brushes.Accent}" />
            <Setter Property="Margin" Value="2" />
            <Setter Property="TitleFontSize" Value="16" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
            <Setter Property="ContentTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <controls:AutoDisableImage Source="{Binding}" />
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="mah:Tile">
                        <Grid>
                            <Border x:Name="PART_Border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}">
                                <Grid>
                                    <ContentPresenter />
                                    <Label x:Name="PART_Title"
                                           HorizontalAlignment="{TemplateBinding HorizontalTitleAlignment}"
                                           VerticalAlignment="{TemplateBinding VerticalTitleAlignment}"
                                           Foreground="{TemplateBinding Foreground}"
                                           Visibility="Collapsed">
                                        <AccessText Margin="3"
                                                    FontSize="{TemplateBinding TitleFontSize}"
                                                    Foreground="{TemplateBinding Foreground}"
                                                    Text="{TemplateBinding Title}"
                                                    TextWrapping="Wrap" />
                                    </Label>
                                </Grid>
                            </Border>
                            <Border x:Name="PART_HoverBorder"
                                    BorderBrush="{TemplateBinding mah:ControlsHelper.MouseOverBorderBrush}"
                                    BorderThickness="2"
                                    Opacity="0"
                                    SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Content" Value="{x:Null}">
                                <Setter TargetName="PART_Title" Property="Visibility" Value="Visible" />
                            </Trigger>
                            <Trigger Property="Button.IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform CenterX="0.5" CenterY="0.5" ScaleX="0.98" ScaleY="0.98" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value=".55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <ListBox x:Name="libraryItemsView" ItemsSource="{Binding ItemsView}"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid>
                        <dxmvvm:Interaction.Behaviors>
                            <behaviors:AutoResizeBehavior MaxItemWidth="250" />
                        </dxmvvm:Interaction.Behaviors>
                    </UniformGrid>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type models:SteamApp}">
                    <Grid>
                        <!-- Command="{Binding ManageAppCommand}" -->
                        <mah:Tile Title="{Binding Name}"
                                  Content="{Binding Header, Converter={StaticResource BitmapToImageSourceConverter}}"
                                  Style="{StaticResource LibraryTileStyle}"
                                  Width="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=ListBoxItem}, Path=ActualWidth}"
                                  Command="{Binding ViewOnSteamDBCommand}">
                            <mah:Tile.ToolTip>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0} ({1})">
                                            <Binding Path="Name" />
                                            <Binding Path="Id" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </mah:Tile.ToolTip>
                        </mah:Tile>
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</UserControl>
